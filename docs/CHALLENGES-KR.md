Things Factory를 개발하는 과정에서 해결해온 challenges

# 모듈간의 종속성

```
개발 대상 모듈 : 현재 개발하고 있는 대상 모듈이다. node_modules 아래에 있는 모듈이 아니며, 현재 디렉토리에 package.json과 소스코드 그리고 리소스를 포함하는 프로젝트를 말한다.
어플리케이션을 구성하는 각 모듈들은 그 관계속에서 여러가지 역할이 될 수 있다.
크게 3가지 모듈로 구분할 수 있다.

1. 어플리케이션
  - 여러가지 모듈을 구성해서 실제 사용될 어플리케이션을 구성하는 모듈이다.
  - 이 모듈의 주 역할은 어플리케이션에서 필요한 기능들을 구현한 여러가지 모듈들을 구성하는 용도이다.
  - 또한, 어플리케이션 모듈은 전체 어플리케이션의 브랜딩, UI 커스터마이징, 스타일 테마 구성, 이미지 등 리소스를 이용한 어플리케이션 커스터마이징을 담당한다.
2. shell
  - 실제 어플리케이션의 entry point이며, 모듈들이 전체적으로 조화롭게 조립될 수 있도록 프레임워크 역할을 한다.
  - 어플리케이션을 빌드하기 위한 기능과 구조를 제공한다.
  - 대부분의 복잡한 문제를 해결하고 있다.
3. 기능 모듈
  - 최대한 단순화되고 책임이 명확한 (원자화된)기능을 구현한 모듈이다.
  - 수많은 기능 모듈의 조립만으로 다양한 어플리케이션들이 만들어질 수 있게되는 마이크로 모듈들이다.
```

- 마이크로 모듈 구조
  - 모듈 책임을 단순하고 명확하게
  - 모듈간의 종속성을 단순하게
  - 단점. 모듈간의 연관관계에서 개발을 하는 경우에 여러 모듈에서 수정이 발생하는 경우에 잦은 모듈 커밋이 발생할 가능성이 높다.
    - 이런 단점을 커버하기 위해 npm link를 사용해야하는데, 이 경우에 link를 정확하게 해제해주어야 하는 번거로움이 있다.
    - 이 부분을 해결해줄 수 있는 가시적인 툴이 있으면 좋겠다.
- 단위 모듈을 개발할 때도 전체적인 어플리케이션 환경에서 구현, 테스트, 디버깅을 원할하게 할 수 있어야함.

  - 어플리케이션 규모의 실행환경에서 각 모듈은 많은 종속관계사이의 어딘가에 위치한다
  - 테스트를 위한 모듈들은 node_modules 에 설치된다.
  - node_modules 에 설치된 모듈들은 개발하려는 모듈과 다양한 종속관계를 형성한다.
  - 심지어, node_modules 에는 개발하려는 모듈 자신의 과거 버전이 포함될 수도 있다.
  - 개발하려는 모듈 자신은 같은 이름의 모듈이 node_modules에 설치되는 여부와 관계없이 자신도 모듈 구성원으로 조립되는 것을 보장해야한다.
  - 이런 보장은 shell에서 제공되는 방법으로 가능해진다.
  - node_modules에는 nodejs가 사용하는 모듈과 browser 어플리케이션이 사용하는 모듈들이 섞여있다.
  - nodejs는 모듈 resolve를 위한 다양한 방법을 제공하지 않는다. 오로지 node_modules에서만 찾는다.
    - 따라서 개발하려는 모듈도 종속관계에 결합되기 위해서는 nodejs가 시작되기 전에 node_modules 폴더에 자신을 링크할 수 있는 폴더를 만들어 주어야 한다.
  - browser 어플리케이션 구성을 위해 사용되는 webpack은 다양한 모듈 resolve 방법을 제공한다.
    - webpack 컨피규레이션에는 alias를 사용해서 node_modules에서 찾지 말고, 개발중인 모듈 폴더를 찾으라고 설정해준다.
    - 이렇게 해서 node_modules에 동일한 이름의 모듈이 설치되어있어도 무시하게 된다.
    - 하지만, copywebpack 플러그인을 이용해서 모듈의 리소스를 빌드 타겟폴더에 복사하는 작업 등을 할 때는 node_modules에 설치된 동일한 이름의 모듈의 리소스가 복사될 수 있으므로 주의해야한다.
    - 따라서, 가급적 빌드 전에 node_modules 에 설치된 동일한 이름의 모듈에서 리소스를 미리 삭제해서 이전 버전의 리소스가 빌드 타겟 폴더에 복사되는 것을 방지한다.
    - 그리고, 개발 중인 모듈의 리소스를 별도로 복사해주는 태스크를 빌드 환경에 포함해주어야 한다.

- 모든 모듈은 어플리케이션 빌드의 복잡한 구조를 고민하지 않아도 되도록 모든 것을 담당해주는 모듈을 중심으로 구성한다.
  - 이것을 shell 이라고 개념 정의한다.
  - shell 은 어플리케이션 구성과 모듈 종속관계를 정리하고 최종 이미지 빌드 기능을 제공한다.
  - shell 은 모듈의 복잡한 (트리구조) 종속관계를 정리해서 단순 배열구조로 만들어준다.
  - shell 은 어플리케이션 시작 시점에 모듈별로 필요한 작업을 할 수 있도록 부트스트랩을 호출해준다.
  - 부트스트랩은 모듈 종속관계가 단순 배열구조로 정리된 모듈 종속관계 순으로 실행하므로, 상위 모듈이 하위 모듈보다 먼저 실행되는 것을 보장한다.

# Extension Point

- 각 모듈간에는 종속관계에서도 커플링을 최소화하기 위해서 Extension Point를 제공하는 상위 모듈에 하위모듈은 필요한 기능을 접속하는 일관된 방법을 사용한다.
  - things factory에서는 이를 위해 redux 패턴을 활용한다.
  - 상위 모듈은 제공하고자 하는 기능과 구조를 구현한다.
  - 상위 모듈은 자신이 제공하는 서비스(기능, 구조)를 사용할 하위 모듈이 접속할 것을 가정하고 그 방법을 제공한다.
  - 상위 모듈은 reducer를 정의하고, 하위모듈은 dispatch로 상위모듈의 기능에 접속한다.

# Things Scene

- things-scene 과 관련된 문제는 별도 SCENE-KR.md 파일에서 다룬다.

# 테스트 방법론

-
