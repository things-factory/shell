#!/usr/bin/env node

'use strict'

const AppRootPath = require('app-root-path').path

var args = process.argv.filter(arg => arg.startsWith('--'))
var platformArgIdx = args.findIndex(a => /--platform/.test(a))

var platform = args.splice(platformArgIdx, 1).join()
var matched = platform.match(/--platform=(\w+)/)

platform = matched ? matched[1] : 'android'

var argString = args.join(' ')

var spawn = require('child_process').spawn

var path = require('path')
var shellModulePath = path.resolve(AppRootPath, 'node_modules', '@things-factory/shell')

var cordova = spawn('cordova', ['run', platform, argString], {
  cwd: shellModulePath
})
cordova.stdout.on('data', function(data) {
  console.log(data.toString())
})

cordova.stderr.on('data', function(data) {
  console.log('stderr: ' + data.toString())
})

cordova.on('exit', function(code) {
  console.log('child process exited with code ' + code.toString())
})
